<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortitude Frontier - Unleash Your Potential</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        /* Custom CSS for Fortitude Frontier - Orange & Black Theme */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0D0D0D; /* Background: Very dark grey/black */
            color: #FFFFFF; /* On-Background/On-Surface: White text */
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        /* Added for preventing scrolling when modals/menus are open */
        body.overflow-hidden {
            overflow: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Preloader styles */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0D0D0D, #1A1A1A, #0D0D0D); /* Gradient matching theme background/surface */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999; /* Highest z-index */
            opacity: 1;
            visibility: visible;
            transition: opacity 0.8s ease-out, visibility 0.8s ease-out;
        }

        #preloader.hidden {
            opacity: 0;
            visibility: hidden;
        }

        #preloader img {
            max-width: 200px;
            animation: bounceIn 1s forwards ease-out, pulse 1.5s infinite ease-in-out 1s; /* Logo animation */
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Navbar link hover animation */
        .nav-link {
            position: relative;
            transition: color 0.3s ease, transform 0.2s ease;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -2px;
            width: 0;
            height: 2px;
            background-color: #FF8C00; /* Vibrant Orange */
            transition: width 0.3s ease-out;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .nav-link:hover {
            transform: translateY(-2px);
            color: #FF8C00; /* Vibrant Orange */
        }

        /* Hero section animations */
        .hero-text {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInSlideUp 1s forwards ease-out;
            animation-delay: 0.8s; /* Adjusted delay for preloader */
        }

        .hero-text.slogan {
            animation-delay: 1.2s; /* Staggered delay */
        }

        .hero-button {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInSlideUp 1s forwards ease-out, pulseButton 2s infinite ease-in-out 1.6s; /* Pulse starts after slide-up */
            transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
        }

        .hero-button:hover {
            transform: scale(1.08) translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 140, 0, 0.4); /* Vibrant Orange shadow */
            animation: none; /* Stop pulse on hover */
        }

        @keyframes pulseButton {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }

        @keyframes fadeInSlideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Card hover animation */
        .interactive-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            border: 1px solid transparent;
        }

        .interactive-card:hover {
            transform: translateY(-8px) scale(1.02) rotateZ(1deg); /* Slight rotation */
            box-shadow: 0 15px 30px rgba(255, 140, 0, 0.3); /* Vibrant Orange shadow */
            border-color: #FF8C00; /* Vibrant Orange border on hover */
        }

        .action-button {
            background-color: #FF8C00; /* Vibrant Orange */
            color: #0D0D0D; /* On-Primary: Dark text */
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .action-button:hover {
            background-color: #FF7F00; /* Darker Orange on hover */
            transform: scale(1.05);
            color: #FFFFFF; /* On-Secondary: White text */
        }

        /* Scroll reveal animation for individual elements */
        .scroll-reveal-item {
            opacity: 0;
            transform: translateY(50px) scale(0.95); /* Initial state: slightly down and scaled */
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
            /* transition-delay will be set by JS */
        }

        .scroll-reveal-item.is-visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* Animated Blob Background in Hero (colors updated for new theme) */
        .blob-container {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0; /* Behind content */
            opacity: 0.3; /* Subtle transparency */
        }

        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px); /* Soft blur effect */
            opacity: 0.6; /* Opacity for each blob */
            animation: blobMove 20s infinite alternate ease-in-out;
        }

        .blob-1 {
            width: 500px;
            height: 500px;
            background-color: #FF8C00; /* Vibrant Orange */
            top: -10%;
            left: -10%;
            animation-delay: 0s;
        }
        .blob-2 {
            width: 600px;
            height: 600px;
            background-color: #FF8C00; /* Vibrant Orange */
            bottom: -15%;
            right: -15%;
            animation-delay: 7s;
        }
        .blob-3 {
            width: 450px;
            height: 450px;
            background-color: #1A1A1A; /* Surface Variant */
            top: 20%;
            right: 5%;
            animation-delay: 14s;
        }

        @keyframes blobMove {
            0% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(20%, 30%) scale(1.1); }
            50% { transform: translate(-30%, -20%) scale(0.9); }
            75% { transform: translate(10%, -10%) scale(1.2); }
            100% { transform: translate(0, 0) scale(1); }
        }

        /* Responsive YouTube embed container */
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            border-radius: 0.75rem; /* rounded-xl equivalent */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Modal for Quiz Results and Login/Signup */
        .modal {
            position: fixed;
            z-index: 9997; /* Adjusted z-index */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal.show {
            visibility: visible;
            opacity: 1;
        }
        .modal-content {
            background-color: #1A1A1A; /* Surface color */
            margin: auto;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 700px;
            position: relative;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
            max-height: 90vh; 
            overflow-y: auto; 
        }
        .modal.show .modal-content {
            transform: translateY(0);
        }
        .close-button {
            color: #FFFFFF;
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .close-button:hover,
        .close-button:focus {
            color: #FF8C00; /* Vibrant Orange */
        }
        .loading-spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid #FF8C00; /* Vibrant Orange */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Message box styling */
        .message-box {
            background-color: #2A2A2A;
            color: #FFFFFF;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            text-align: center;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9998; /* Adjusted z-index */
            min-width: 300px;
            max-width: 90%;
            display: none; /* Hidden by default */
        }
        .message-box.show {
            display: block;
        }
        .message-box button {
            margin-top: 1rem;
            background-color: #FF8C00;
            color: #0D0D0D;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .message-box button:hover {
            background-color: #FF7F00;
            transform: scale(1.05);
        }
        #logoimg{
          
           height: 10vh;
           padding: 0;
}
        }
    </style>
</head>
<body class="bg-[#0D0D0D] text-[#FFFFFF]">

    <!-- Message Box for Alerts/Confirmations -->
    <div id="custom-message-box" class="message-box">
        <p id="message-box-text" class="text-lg mb-4"></p>
        <button id="message-box-confirm-btn">OK</button>
    </div>

    <!-- Preloader -->
    <div id="preloader">
        <!-- Using a placeholder for your logo that matches the new theme -->
        <img src="fflogo-removebg-preview.png" alt="Fortitude Frontier Logo">
    </div>

    <!-- Navbar -->
    <nav class="p-6 md:bg-[#1A1A1A] shadow-lg fixed top-0 w-full z-50"> <!-- Surface color, fixed, top-0, w-full, higher z-index -->
        <div class="container flex justify-between items-center">
            <a href="#"  class=" md:text-xl"><img src="fflogo-removebg-preview.png" id="logoimg"></a> <!-- Primary text, darker orange on hover -->
            <div class="hidden sm:flex flex-wrap justify-end items-center sm:gap-x-4 sm:gap-y-2"> <!-- Changed md:flex to sm:flex, and added adaptive gaps -->
                <a href="#about" class="nav-link text-lg text-[#FFFFFF] hover:text-white transition duration-300">About Us</a>
                <a href="#quizzes" class="nav-link text-lg text-[#FFFFFF] hover:text-white transition duration-300">Quizzes</a>
                <a href="#fun-saturday" class="nav-link text-lg text-[#FFFFFF] hover:text-white transition duration-300">Fun Saturday</a>
                <a href="#course-playlist" class="nav-link text-lg text-[#FFFFFF] hover:text-white transition duration-300">Course Playlist</a>
                <a href="#ai-study-buddy" class="nav-link text-lg text-[#FFFFFF] hover:text-white transition duration-300">AI Study Buddy ✨</a>
                <a href="#contact" class="nav-link text-lg text-[#FFFFFF] hover:text-white transition duration-300">Contact</a>
                <!-- Login/Logout buttons -->
                <div id="auth-buttons">
                    <button id="login-signup-btn" class="action-button font-bold py-2 px-4 rounded-full text-sm">Login / Sign Up</button>
                </div>
                <div id="user-info" class="hidden flex items-center sm:space-x-2"> <!-- Adjusted spacing for user-info on small screens -->
                    <span id="user-email" class="text-white text-sm whitespace-nowrap overflow-hidden text-ellipsis max-w-[150px]"></span> <!-- Increased max-w for user-email -->
                    <button id="logout-btn" class="action-button font-bold py-2 px-4 rounded-full text-sm">Logout</button>
                </div>
            </div>
            <!-- Mobile Menu Button -->
            <button id="mobile-menu-button" class="sm:hidden text-[#FFFFFF] focus:outline-none"> <!-- Changed md:hidden to sm:hidden -->
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                </svg>
            </button>
        </div>
        <!-- Mobile Menu Overlay -->
        <div id="mobile-menu-overlay" class="hidden sm:hidden fixed inset-0 bg-[#0D0D0D] bg-opacity-100 z-9996 flex flex-col items-center justify-center space-y-8 text-2xl"> <!-- Background color, changed md:hidden to sm:hidden -->
            <button id="close-mobile-menu" class="absolute top-6 right-6 text-[#FFFFFF] focus:outline-none">
                <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            <a href="#about" class="nav-link text-[#FFFFFF] hover:text-white transition duration-300" onclick="document.getElementById('mobile-menu-overlay').classList.add('hidden'); document.body.classList.remove('overflow-hidden');">About Us</a>
            <a href="#quizzes" class="nav-link text-[#FFFFFF] hover:text-white transition duration-300" onclick="document.getElementById('mobile-menu-overlay').classList.add('hidden'); document.body.classList.remove('overflow-hidden');">Quizzes</a>
            <a href="#fun-saturday" class="nav-link text-[#FFFFFF] hover:text-white transition duration-300" onclick="document.getElementById('mobile-menu-overlay').classList.add('hidden'); document.body.classList.remove('overflow-hidden');">Fun Saturday</a>
            <a href="#course-playlist" class="nav-link text-[#FFFFFF] hover:text-white transition duration-300" onclick="document.getElementById('mobile-menu-overlay').classList.add('hidden'); document.body.classList.remove('overflow-hidden');">Course Playlist</a>
            <a href="#ai-study-buddy" class="nav-link text-[#FFFFFF] hover:text-white transition duration-300" onclick="document.getElementById('mobile-menu-overlay').classList.add('hidden'); document.body.classList.remove('overflow-hidden');">AI Study Buddy ✨</a>
            <a href="#contact" class="nav-link text-[#FFFFFF] hover:text-white transition duration-300" onclick="document.getElementById('mobile-menu-overlay').classList.add('hidden'); document.body.classList.remove('overflow-hidden');">Contact</a>
            <button id="mobile-login-signup-btn" class="action-button font-bold py-2 px-4 rounded-full text-xl sm:hidden">Login / Sign Up</button> <!-- Changed md:hidden to sm:hidden -->
            <div id="mobile-user-info" class="hidden flex-col items-center space-y-2 sm:hidden"> <!-- Changed md:hidden to sm:hidden -->
                <span id="mobile-user-email" class="text-white text-xl"></span>
                <button id="mobile-logout-btn" class="action-button font-bold py-2 px-4 rounded-full text-xl">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Login/Signup Modal -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="auth-close-button">&times;</span>
            <h3 class="text-3xl font-bold text-[#FF8C00] mb-6 text-center" id="auth-modal-title">Login</h3>
            <div class="flex flex-col space-y-4">
                <input type="email" id="auth-email" class="w-full p-3 rounded-md bg-[#0D0D0D] text-[#FFFFFF] border border-[#FF8C00] focus:outline-none focus:ring-2 focus:ring-[#FF8C00]" placeholder="Email" required>
                <input type="password" id="auth-password" class="w-full p-3 rounded-md bg-[#0D0D0D] text-[#FFFFFF] border border-[#FF8C00] focus:outline-none focus:ring-2 focus:ring-[#FF8C00]" placeholder="Password" required>
                <button id="auth-submit-btn" class="action-button font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105">Login</button>
                <p id="auth-error-message" class="text-red-400 text-center"></p>
                <button id="toggle-auth-mode" class="text-[#FF8C00] hover:underline text-sm mt-2">Don't have an account? Sign Up</button>
                <button id="resend-verification-btn" class="action-button font-bold py-2 px-4 rounded-full text-sm mt-4 hidden">Resend Verification Email</button>
            </div>
        </div>
    </div>

    <!-- Quiz Modal -->
    <div id="quiz-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="quiz-close-button">&times;</span>
            <h3 class="text-3xl font-bold text-[#FF8C00] mb-6 text-center" id="quiz-title"></h3>
            <div id="quiz-loading-spinner" class="loading-spinner hidden"></div>
            <div id="quiz-questions-container" class="flex flex-col space-y-6">
                <!-- Quiz questions will be dynamically loaded here -->
            </div>
            <div id="quiz-controls" class="flex justify-center mt-8 space-x-4">
                <button id="quiz-submit-btn" class="action-button font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 hidden">Submit Quiz</button>
                <button id="quiz-retake-btn" class="action-button font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 hidden">Retake Quiz</button>
            </div>
            <div id="quiz-results" class="text-center mt-6 text-lg font-bold">
                <!-- Quiz results will be displayed here -->
            </div>
        </div>
    </div>


    <!-- Hero Section -->
    <header class="relative h-screen flex items-center justify-center overflow-hidden hero-bg-overlay pt-24"> <!-- Added pt-24 -->
        <!-- Animated Blob Background (colors updated) -->
        <div class="blob-container">
            <div class="blob blob-1"></div>
            <div class="blob blob-2"></div>
            <div class="blob blob-3"></div>
        </div>
        <!-- Content -->
        <div class="relative z-10 text-center p-6">
            <h1 class="text-5xl md:text-7xl font-extrabold text-white leading-tight mb-4 hero-text">
                <span class="block text-[#FF8C00]">FORTITUDE FRONTIER</span> <!-- Vibrant Orange -->
                <span class="block text-[#FF8C00] slogan">Unleash Your Potential.</span> <!-- Vibrant Orange -->
            </h1>
            <p class="text-lg md:text-xl text-[#FFFFFF] mb-8 hero-text">Your journey to academic excellence and personal growth starts here.</p>
            <a href="#quizzes" class="inline-block bg-[#FF8C00] hover:bg-[#FF7F00] text-[#0D0D0D] font-bold py-3 px-8 rounded-full shadow-lg hero-button"> <!-- Vibrant Orange BG, darker orange hover, dark text -->
                Start Learning Now!
            </a>
        </div>
    </header>

    <!-- About Us Section -->
    <section id="about" class="py-16 md:py-24 bg-[#0D0D0D]"> <!-- Background color -->
        <div class="container text-center max-w-4xl">
            <h2 class="text-4xl md:text-5xl font-bold mb-8 text-[#FF8C00] scroll-reveal-item">About Fortitude Frontier</h2> <!-- Vibrant Orange -->
            <p class="text-lg md:text-xl leading-relaxed text-[#FFFFFF] mb-6 scroll-reveal-item" style="--delay: 0.1s;">
                At Fortitude Frontier, we are dedicated to providing top-tier coaching that goes beyond textbooks. We foster an environment where students not only excel academically but also develop critical thinking skills, problem-solving abilities, and unwavering confidence.
            </p>
            <p class="text-lg md:text-xl leading-relaxed text-[#FFFFFF] scroll-reveal-item" style="--delay: 0.2s;">
                Our expert faculty, personalized attention, and innovative teaching methodologies ensure every student reaches their full potential. Join us to transform challenges into opportunities and build a strong foundation for your future.
            </p>
        </div>
    </section>

    <!-- Quizzes Section -->
    <section id="quizzes" class="py-16 md:py-24 bg-[#1A1A1A]"> <!-- Surface color -->
        <div class="container text-center">
            <h2 class="text-4xl md:text-5xl font-bold mb-12 text-[#FF8C00] scroll-reveal-item">Challenge Yourself with Quizzes!</h2> <!-- Vibrant Orange -->
            <p class="text-lg md:text-xl text-[#FFFFFF] mb-10 scroll-reveal-item" style="--delay: 0.1s;">Test your knowledge and sharpen your skills with our interactive quizzes, or generate new ones with AI!</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Quiz Card 1 -->
                <div class="interactive-card bg-[#2A2A2A] rounded-xl shadow-lg p-6 flex flex-col items-center"> <!-- Slightly lighter surface variant -->
                    <img src="https://placehold.co/150x150/1A1A1A/FFFFFF?text=MATH" alt="Math Quiz" class="w-24 h-24 mb-4 rounded-full border-4 border-[#FF8C00] scroll-reveal-item" style="--delay: 0.2s;">
                    <h3 class="text-2xl font-semibold text-white mb-2 scroll-reveal-item" style="--delay: 0.3s;">Mathematics Mastery</h3>
                    <p class="text-gray-400 mb-4 text-center scroll-reveal-item" style="--delay: 0.4s;">Algebra, Geometry, Calculus.</p>
                    <button class="action-button font-bold py-2 px-6 rounded-full generate-quiz-btn scroll-reveal-item" data-topic="Mathematics" style="--delay: 0.5s;">Generate Quiz ✨</button>
                </div>
                <!-- Quiz Card 2 -->
                <div class="interactive-card bg-[#2A2A2A] rounded-xl shadow-lg p-6 flex flex-col items-center">
                    <img src="https://placehold.co/150x150/1A1A1A/FFFFFF?text=SCIENCE" alt="Science Quiz" class="w-24 h-24 mb-4 rounded-full border-4 border-[#FF8C00] scroll-reveal-item" style="--delay: 0.2s;">
                    <h3 class="text-2xl font-semibold text-white mb-2 scroll-reveal-item" style="--delay: 0.3s;">Science Explorer</h3>
                    <p class="text-gray-400 mb-4 text-center scroll-reveal-item" style="--delay: 0.4s;">Physics, Chemistry, Biology.</p>
                    <button class="action-button font-bold py-2 px-6 rounded-full generate-quiz-btn scroll-reveal-item" data-topic="Science" style="--delay: 0.5s;">Generate Quiz ✨</button>
                </div>
                <!-- Quiz Card 3 -->
                <div class="interactive-card bg-[#2A2A2A] rounded-xl shadow-lg p-6 flex flex-col items-center">
                    <img src="https://placehold.co/150x150/1A1A1A/FFFFFF?text=HISTORY" alt="History Quiz" class="w-24 h-24 mb-4 rounded-full border-4 border-[#FF8C00] scroll-reveal-item" style="--delay: 0.2s;">
                    <h3 class="text-2xl font-semibold text-white mb-2 scroll-reveal-item" style="--delay: 0.3s;">History Highlights</h3>
                    <p class="text-gray-400 mb-4 text-center scroll-reveal-item" style="--delay: 0.4s;">Ancient, Modern, World.</p>
                    <button class="action-button font-bold py-2 px-6 rounded-full generate-quiz-btn scroll-reveal-item" data-topic="History" style="--delay: 0.5s;">Generate Quiz ✨</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Fun Saturday Section -->
    <section id="fun-saturday" class="py-16 md:py-24 bg-[#0D0D0D]"> <!-- Background color -->
        <div class="container text-center">
            <h2 class="text-4xl md:text-5xl font-bold mb-12 text-[#FF8C00] scroll-reveal-item">Fortitude Fun Saturdays!</h2> <!-- Vibrant Orange -->
            <p class="text-lg md:text-xl text-[#FFFFFF] mb-10 scroll-reveal-item" style="--delay: 0.1s;">Learning isn't just about books! Join us for exciting and enriching activities every Saturday.</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Fun Activity Card 1 -->
                <div class="interactive-card bg-[#2A2A2A] rounded-xl shadow-lg p-6 flex flex-col items-center cursor-pointer scroll-reveal-item" style="--delay: 0.2s;">
                    <img src="https://placehold.co/150x150/1A1A1A/FFFFFF?text=DEBATE" alt="Debate Club" class="w-24 h-24 mb-4 rounded-full border-4 border-[#FF8C00]">
                    <h3 class="text-2xl font-semibold text-white mb-2">Debate & Public Speaking</h3>
                    <p class="text-gray-400 mb-4 text-center">Sharpen your arguments and confidence.</p>
                    <button class="action-button font-bold py-2 px-6 rounded-full learn-more-btn"
                            data-activity-title="Debate & Public Speaking"
                            data-activity-info="Join our Debate & Public Speaking club to hone your argumentative skills, boost your confidence, and become a persuasive communicator. Every Saturday, we tackle engaging topics, providing a dynamic platform to express your ideas and engage in healthy discourse.">Learn More</button>
                </div>
                <!-- Fun Activity Card 2 -->
                <div class="interactive-card bg-[#2A2A2A] rounded-xl shadow-lg p-6 flex flex-col items-center cursor-pointer scroll-reveal-item" style="--delay: 0.3s;">
                    <img src="https://placehold.co/150x150/1A1A1A/FFFFFF?text=CODING" alt="Coding Workshop" class="w-24 h-24 mb-4 rounded-full border-4 border-[#FF8C00]">
                    <h3 class="text-2xl font-semibold text-white mb-2">Creative Coding Workshops</h3>
                    <p class="text-gray-400 mb-4 text-center">Explore logic and build cool projects.</p>
                    <button class="action-button font-bold py-2 px-6 rounded-full learn-more-btn"
                            data-activity-title="Creative Coding Workshops"
                            data-activity-info="Unleash your creativity and logical thinking in our Creative Coding Workshops. Learn fundamental programming concepts through fun, hands-on projects, from building simple games to designing interactive art. No prior experience needed!">Learn More</button>
                </div>
                <!-- Fun Activity Card 3 -->
                <div class="interactive-card bg-[#2A2A2A] rounded-xl shadow-lg p-6 flex flex-col items-center cursor-pointer scroll-reveal-item" style="--delay: 0.4s;">
                    <img src="https://placehold.co/150x150/1A1A1A/FFFFFF?text=ART" alt="Art & Craft" class="w-24 h-24 mb-4 rounded-full border-4 border-[#FF8C00]">
                    <h3 class="text-2xl font-semibold text-white mb-2">Art & Innovation Challenges</h3>
                    <p class="text-gray-400 mb-4 text-center">Unleash your inner artist and inventor.</p>
                    <button class="action-button font-bold py-2 px-6 rounded-full learn-more-btn"
                            data-activity-title="Art & Innovation Challenges"
                            data-activity-info="Ignite your imagination with our Art & Innovation Challenges. Experiment with various art forms and participate in creative problem-solving challenges that encourage innovative thinking and artistic expression.">Learn More</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Course Playlist Section -->
    <section id="course-playlist" class="py-16 md:py-24 bg-[#1A1A1A]"> <!-- Surface color -->
        <div class="container text-center">
            <h2 class="text-4xl md:text-5xl font-bold mb-12 text-[#FFFFFF] scroll-reveal-item">Our Course Playlists</h2> <!-- On-Surface text -->
            <p class="text-lg md:text-xl text-[#FFFFFF] mb-10 scroll-reveal-item" style="--delay: 0.1s;">Access our curated video lessons and deepen your understanding.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Video 1: Placeholder Math Series -->
                <div class="bg-[#2A2A2A] rounded-xl shadow-lg p-4 interactive-card scroll-reveal-item" style="--delay: 0.2s;">
                    <h3 class="text-2xl font-semibold text-white mb-4">Algebra Fundamentals</h3>
                    <div class="video-container">
                        <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                    </div>
                    <p class="text-gray-400 mt-4">Essential concepts for strong mathematical foundations.</p>
                </div>
                <!-- Video 2: Placeholder Science Series -->
                <div class="bg-[#2A2A2A] rounded-xl shadow-lg p-4 interactive-card scroll-reveal-item" style="--delay: 0.3s;">
                    <h3 class="text-2xl font-semibold text-white mb-4">Physics Principles Explained</h3>
                    <div class="video-container">
                        <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                    </div>
                    <p class="text-gray-400 mt-4">Demystifying the laws that govern our universe.</p>
                </div>
                 <!-- Video 3: Placeholder English Grammar -->
                <div class="bg-[#2A2A2A] rounded-xl shadow-lg p-4 interactive-card scroll-reveal-item" style="--delay: 0.4s;">
                    <h3 class="text-2xl font-semibold text-white mb-4">English Grammar Essentials</h3>
                    <div class="video-container">
                        <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                    </div>
                    <p class="text-gray-400 mt-4">Mastering sentence structure and effective communication.</p>
                </div>
                 <!-- Video 4: Placeholder History Deep Dive -->
                <div class="bg-[#2A2A2A] rounded-xl shadow-lg p-4 interactive-card scroll-reveal-item" style="--delay: 0.5s;">
                    <h3 class="text-2xl font-semibold text-white mb-4">World History - Ancient Civilizations</h3>
                    <div class="video-container">
                        <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                    </div>
                    <p class="text-gray-400 mt-4">Journey through pivotal moments that shaped our world.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- AI Study Buddy Section -->
    <section id="ai-study-buddy" class="py-16 md:py-24 bg-[#0D0D0D]"> <!-- Background color -->
        <div class="container text-center max-w-4xl">
            <h2 class="text-4xl md:text-5xl font-bold mb-8 text-[#FF8C00] scroll-reveal-item">AI Study Buddy ✨</h2>
            <p class="text-lg md:text-xl leading-relaxed text-[#FFFFFF] mb-6 scroll-reveal-item" style="--delay: 0.1s;">
                Ask your AI Study Buddy to explain any concept, provide definitions, or summarize topics!
            </p>
            <div class="bg-[#1A1A1A] rounded-xl shadow-lg p-8 scroll-reveal-item" style="--delay: 0.2s;">
                <textarea id="study-buddy-input" class="w-full p-4 rounded-md bg-[#0D0D0D] text-[#FFFFFF] border border-[#FF8C00] focus:outline-none focus:ring-2 focus:ring-[#FF8C00]" rows="4" placeholder="e.g., Explain photosynthesis for a high school student..."></textarea>
                <button id="get-explanation-btn" class="action-button font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105">Get Explanation ✨</button>
                <div id="study-buddy-loading" class="loading-spinner hidden mt-4"></div>
                <div id="study-buddy-output" class="text-left mt-6 p-4 bg-[#0D0D0D] rounded-md border border-[#FF8C00] whitespace-pre-wrap">
                    <!-- AI explanation will appear here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section class="py-16 md:py-24 bg-[#1A1A1A]"> <!-- Surface color -->
        <div class="container text-center max-w-4xl">
            <h2 class="text-4xl md:text-5xl font-bold mb-12 text-[#FFFFFF] scroll-reveal-item">What Our Students Say</h2> <!-- On-Background text -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-[#2A2A2A] rounded-xl shadow-lg p-6 text-left scroll-reveal-item" style="--delay: 0.2s;">
                    <p class="text-lg leading-relaxed italic mb-4">"Fortitude Frontier changed my perspective on learning. The interactive quizzes made studying fun, and the Fun Saturdays were a blast! Highly recommend!"</p>
                    <p class="font-semibold text-[#FF8C00]">- Anya Sharma, Class of '24</p> <!-- Vibrant Orange -->
                </div>
                <div class="bg-[#2A2A2A] rounded-xl shadow-lg p-6 text-left scroll-reveal-item" style="--delay: 0.3s;">
                    <p class="text-lg leading-relaxed italic mb-4">"The personalized attention here is incredible. I felt supported every step of the way, and the extra activities really helped me think outside the box."</p>
                    <p class="font-semibold text-[#FF8C00]">- Rohan Singh, Class of '23</p> <!-- Vibrant Orange -->
                </div>
            </div>
        </div>
    </section>

    <!-- Call to Action Section -->
    <section class="py-16 md:py-24 bg-[#0D0D0D]"> <!-- Background color -->
        <div class="container text-center">
            <h2 class="text-4xl md:text-5xl font-bold text-white mb-8 scroll-reveal-item">Ready to Build Your Fortitude?</h2>
            <p class="text-lg md:text-xl text-[#FFFFFF] mb-10 scroll-reveal-item" style="--delay: 0.1s;">Enroll today and discover your true potential.</p>
            <a href="https://wa.me/919352359645" class="inline-block bg-[#FF8C00] hover:bg-[#FF7F00] text-[#0D0D0D] font-bold py-4 px-10 rounded-full shadow-xl transition duration-300 transform hover:scale-105 hover:animate-pulse scroll-reveal-item" style="--delay: 0.2s;"> <!-- Vibrant Orange BG, darker orange hover, dark text -->
                Enroll Now
            </a>
        </div>
    </section>

    <!-- Footer -->
    <footer id="contact" class="bg-[#1A1A1A] py-12 md:py-16"> <!-- Surface color -->
        <div class="container text-center text-gray-400">
            <p class="mb-4">&copy; Fortitude Frontier. All rights reserved.</p>
            <div class="flex justify-center space-x-6">
                <a href="#" class="hover:text-white transition duration-300">Privacy Policy</a>
                <a href="#" class="hover:text-white transition duration-300">Terms of Service</a>
            </div>
            <div class="mt-8">
                <p>Connect with Us:</p>
                <div class="flex justify-center space-x-6 mt-4 text-2xl">
                    <!-- Social icons with theme colors on hover -->
                    <a href="https://www.instagram.com/fortitudefrontier/" class="hover:text-[#FF8C00] transition duration-300"><i class="fa fa-instagram"></i></a> <!-- Vibrant Orange hover -->
                    
                    
                </div>
            </div>
            <p class="mt-8 text-lg">Email: frontierfortitude26@gmail.com</p>
            <p class="text-lg">Phone: +91 9352359645</p>
        </div>
    </footer>

    <!-- FontAwesome for social icons -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <!-- Firebase SDKs -->
    <script type="module" defer>
        // Log to confirm script starts execution
        console.log("Script started.");

        // Import necessary Firebase modules
        // ALL Firebase SDK imports are now using version 11.8.1 for consistency.
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendEmailVerification } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

        // Firebase App and Services initialization variables
        let app;
        let auth;
        let db;
        let currentUserId = null; // To store the authenticated user's UID for Firestore operations
        let isLoginMode = true; // Moved declaration here to ensure it's defined before use
        let quizData = []; // Store the current quiz questions and answers

        // YOUR PROVIDED FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyCqWbcgSdseuGSd6aLBqG76lAyr647xgQ4",
            authDomain: "signup-b09e6.firebaseapp.com",
            projectId: "signup-b09e6", // This is your project ID
            storageBucket: "signup-b09e6.firebasestorage.app",
            messagingSenderId: "203916695845",
            appId: "1:203916695845:web:5310b5ca37c7809be862cc"
        };

        // This appId variable is used for constructing the Firestore paths.
        // It's correctly set to firebaseConfig.projectId.
        const appId = firebaseConfig.projectId;
        // The initialAuthToken is for Canvas-specific setups. For local email/password login, it remains null.
        const initialAuthToken = null;

        // Initialize Firebase services with the provided configuration immediately.
        app = initializeApp(firebaseConfig);
        auth = getAuth(app);
        db = getFirestore(app);
        console.log("Firebase services initialized.");

        /**
         * Custom message box function to replace alert/confirm.
         */
        const showMessageBox = (message, onConfirm = null) => {
            const msgBox = document.getElementById('custom-message-box');
            const msgText = document.getElementById('message-box-text');
            const confirmBtn = document.getElementById('message-box-confirm-btn');

            msgText.innerHTML = message; // Use innerHTML for bold tag
            confirmBtn.onclick = () => {
                msgBox.classList.remove('show');
                // Allow scrolling after message box is closed
                document.body.classList.remove('overflow-hidden');
                if (onConfirm) onConfirm();
            };
            msgBox.classList.add('show');
            document.body.classList.add('overflow-hidden'); // Prevent scrolling while message box is open
            console.log("Message box shown:", message);
        };

        /**
         * Handles initial authentication using a custom token or anonymous sign-in.
         * This ensures the app has a user session for Firestore access from the start.
         */
        const handleInitialAuth = async () => {
            try {
                if (initialAuthToken) {
                    // If an initialAuthToken is provided (e.g., by the Canvas environment), use it.
                    await signInWithCustomToken(auth, initialAuthToken);
                    console.log('Firebase: Signed in with custom token.');
                } else {
                    // **MODIFICATION**: Removed signInAnonymously.
                    // Now, if no initialAuthToken is present (typical for local development),
                    // the user will remain unauthenticated until they explicitly log in or sign up.
                    console.log('Firebase: No initial token, user will not be signed in anonymously.');
                }
            } catch (error) {
                console.error('Firebase: Initial authentication error:', error);
                // Inform the user if initial auth fails, e.g., by hiding auth buttons.
                const authButtons = document.getElementById('auth-buttons');
                if (authButtons) {
                    authButtons.innerHTML = '<span class="text-red-400 text-sm">Auth Unavailable</span>';
                }
                const mobileLoginSignupBtn = document.getElementById('mobile-login-signup-btn');
                if (mobileLoginSignupBtn) {
                    mobileLoginSignupBtn.classList.add('hidden');
                }
                showMessageBox("Authentication services are currently unavailable. Please check your internet connection and Firebase project settings.", () => {
                    // Optional: redirect or perform other actions after user acknowledges
                });
            }
        };

        /**
         * Listens for changes in the Firebase authentication state (user login/logout).
         * Updates the UI accordingly.
         */
        onAuthStateChanged(auth, async (user) => {
            const loginSignupBtn = document.getElementById('login-signup-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const mobileLoginSignupBtn = document.getElementById('mobile-login-signup-btn');
            const mobileLogoutBtn = document.getElementById('mobile-logout-btn');
            const userInfoDisplay = document.getElementById('user-info');
            const mobileUserInfoDisplay = document.getElementById('mobile-user-info');
            const userEmailDisplay = document.getElementById('user-email');
            const mobileUserEmailDisplay = document.getElementById('mobile-user-email');

            if (user) {
                // User is logged in
                currentUserId = user.uid; // Store the authenticated user's UID
                console.log('Firebase: User is logged in:', user.email || 'Anonymous', 'UID:', user.uid);

                // Update UI for logged-in state (desktop and mobile)
                if (loginSignupBtn) loginSignupBtn.classList.add('hidden');
                if (mobileLoginSignupBtn) mobileLoginSignupBtn.classList.add('hidden');
                if (userInfoDisplay) userInfoDisplay.classList.remove('hidden');
                if (mobileUserInfoDisplay) mobileUserInfoDisplay.classList.remove('hidden');
                if (userEmailDisplay) userEmailDisplay.textContent = user.email || 'Anonymous User';
                if (mobileUserEmailDisplay) mobileUserEmailDisplay.textContent = user.email || 'Anonymous User';
            } else {
                // User is logged out
                currentUserId = null; // Clear the user ID
                console.log('Firebase: User is logged out.');

                // Update UI for logged-out state (desktop and mobile)
                if (loginSignupBtn) loginSignupBtn.classList.remove('hidden');
                if (mobileLoginSignupBtn) mobileLoginSignupBtn.classList.remove('hidden');
                if (userInfoDisplay) userInfoDisplay.classList.add('hidden');
                if (mobileUserInfoDisplay) mobileUserInfoDisplay.classList.add('hidden');
                if (userEmailDisplay) userEmailDisplay.textContent = '';
                if (mobileUserEmailDisplay) mobileUserEmailDisplay.textContent = '';
            }
        });

        // Preloader and Scroll Reveal Initialization
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOMContentLoaded fired.");
            // Hide preloader as soon as DOM is ready, for faster interaction
            const preloader = document.getElementById('preloader');
            if (preloader) {
                preloader.classList.add('hidden');
                console.log('Preloader hidden on DOMContentLoaded');
            } else {
                console.warn('Preloader element not found.');
            }

            // Trigger initial authentication check here, after DOM is ready
            // This ensures auth setup runs, but doesn't block DOM parsing.
            handleInitialAuth();
            console.log('handleInitialAuth called on DOMContentLoaded');

            // Initialize mobile menu functionality
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const closeMobileMenuButton = document.getElementById('close-mobile-menu');
            const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');

            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenuOverlay.classList.remove('hidden');
                    document.body.classList.add('overflow-hidden'); // Prevent scrolling
                });
            } else {
                console.warn('Mobile menu button not found.');
            }

            if (closeMobileMenuButton) {
                closeMobileMenuButton.addEventListener('click', () => {
                    mobileMenuOverlay.classList.add('hidden');
                    document.body.classList.remove('overflow-hidden'); // Allow scrolling
                });
            } else {
                console.warn('Close mobile menu button not found.');
            }
        });

        // Placeholder for initScrollReveal (if you have one, include it here)
        // This function would typically handle animations that depend on elements being in view.
        // If not defined, this call will produce an error, preventing other scripts from running.
        // Defining it as a no-op to prevent errors if not fully implemented yet.
        const initScrollReveal = () => {
            console.log('initScrollReveal called.');
            // Implement your scroll reveal logic here.
            // Example: using IntersectionObserver for elements with class 'scroll-reveal-item'
            const scrollRevealItems = document.querySelectorAll('.scroll-reveal-item');
            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.1 // Trigger when 10% of item is visible
            };

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        // Optional: Stop observing once visible if animation only runs once
                        observer.unobserve(entry.target);
                    }
                });
            }, observerOptions);

            scrollRevealItems.forEach(item => {
                observer.observe(item);
            });
        };

        window.addEventListener('load', () => {
            console.log('window.load fired.');
            // Only run scroll reveal after all assets (like images) are loaded
            initScrollReveal();
            console.log('initScrollReveal called on window load');
        });


        // --- Login/Signup Modal UI and Logic ---
        const authModal = document.getElementById('auth-modal');
        const authCloseButton = document.getElementById('auth-close-button');
        const loginSignupBtn = document.getElementById('login-signup-btn'); // Desktop login/signup button
        const mobileLoginSignupBtn = document.getElementById('mobile-login-signup-btn'); // Mobile login/signup button
        const authModalTitle = document.getElementById('auth-modal-title');
        const authEmailInput = document.getElementById('auth-email');
        const authPasswordInput = document.getElementById('auth-password');
        const authSubmitBtn = document.getElementById('auth-submit-btn');
        const authErrorMessage = document.getElementById('auth-error-message');
        const toggleAuthModeBtn = document.getElementById('toggle-auth-mode');
        const resendVerificationBtn = document.getElementById('resend-verification-btn');

        // Function to reset modal state
        const resetAuthModal = () => {
            if (authErrorMessage) authErrorMessage.textContent = '';
            if (authEmailInput) authEmailInput.value = '';
            if (authPasswordInput) authPasswordInput.value = '';
            if (resendVerificationBtn) resendVerificationBtn.classList.add('hidden');
        };

        // Check if elements exist before adding listeners to avoid errors if HTML structure changes
        if (loginSignupBtn) {
            loginSignupBtn.addEventListener('click', () => {
                if (authModal) authModal.classList.add('show');
                document.body.classList.add('overflow-hidden'); // Prevent scrolling
                isLoginMode = true; // Set to login mode by default
                if (authModalTitle) authModalTitle.textContent = 'Login';
                if (authSubmitBtn) authSubmitBtn.textContent = 'Login';
                if (toggleAuthModeBtn) toggleAuthModeBtn.textContent = "Don't have an account? Sign Up";
                resetAuthModal();
            });
        }

        if (mobileLoginSignupBtn) {
            mobileLoginSignupBtn.addEventListener('click', () => {
                if (authModal) authModal.classList.add('show');
                document.body.classList.add('overflow-hidden'); // Prevent scrolling
                isLoginMode = true; // Set to login mode by default
                if (authModalTitle) authModalTitle.textContent = 'Login';
                if (authSubmitBtn) authSubmitBtn.textContent = 'Login';
                if (toggleAuthModeBtn) toggleAuthModeBtn.textContent = "Don't have an account? Sign Up";
                resetAuthModal();
                // Ensure mobile menu is closed when the modal opens
                const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
                if (mobileMenuOverlay) mobileMenuOverlay.classList.add('hidden');
            });
        }

        if (authCloseButton) {
            authCloseButton.addEventListener('click', () => {
                if (authModal) authModal.classList.remove('show');
                document.body.classList.remove('overflow-hidden'); // Allow scrolling
                resetAuthModal();
            });
        }

        if (authModal) {
            authModal.addEventListener('click', (e) => {
                if (e.target === authModal) {
                    authModal.classList.remove('show');
                    document.body.classList.remove('overflow-hidden'); // Allow scrolling
                    resetAuthModal();
                }
            });
        }

        if (toggleAuthModeBtn) {
            toggleAuthModeBtn.addEventListener('click', () => {
                isLoginMode = !isLoginMode; // Toggle the mode
                if (isLoginMode) {
                    if (authModalTitle) authModalTitle.textContent = 'Login';
                    if (authSubmitBtn) authSubmitBtn.textContent = 'Login';
                    if (toggleAuthModeBtn) toggleAuthModeBtn.textContent = "Don't have an account? Sign Up";
                } else {
                    if (authModalTitle) authModalTitle.textContent = 'Sign Up';
                    if (authSubmitBtn) authSubmitBtn.textContent = 'Sign Up';
                    if (toggleAuthModeBtn) toggleAuthModeBtn.textContent = 'Already have an account? Login';
                }
                resetAuthModal(); // Reset fields and messages when switching modes
            });
        }

        // Event listener for the Login/Sign Up submission button
        if (authSubmitBtn && authEmailInput && authPasswordInput && authErrorMessage && resendVerificationBtn && authModal) {
            authSubmitBtn.addEventListener('click', async () => {
                const email = authEmailInput.value.trim();
                const password = authPasswordInput.value.trim();
                authErrorMessage.textContent = ''; // Clear previous errors
                resendVerificationBtn.classList.add('hidden'); // Hide resend button initially

                if (!email || !password) {
                    authErrorMessage.textContent = 'Please enter both email and password.';
                    return;
                }

                try {
                    if (isLoginMode) {
                        // --- Login Logic ---
                        const userCredential = await signInWithEmailAndPassword(auth, email, password);
                        const user = userCredential.user;

                        if (user && !user.emailVerified) {
                            // User logged in but email is not verified
                            showMessageBox("Your email is not verified. Please check your inbox for a verification link.", async () => {
                                // After user acknowledges, log them out to enforce verification
                                await signOut(auth);
                                // Show the resend button if needed
                                if (resendVerificationBtn) resendVerificationBtn.classList.remove('hidden');
                            });
                            authErrorMessage.textContent = 'Email not verified. Please check your inbox.';
                            authModal.classList.remove('show'); // Close modal
                            // Log out to ensure they must verify before next login
                            await signOut(auth);
                        } else {
                            // Successful login with verified email
                            console.log('Firebase: User logged in successfully with verified email!');
                            authModal.classList.remove('show'); // Close modal on success
                            document.body.classList.remove('overflow-hidden'); // Allow scrolling
                            showMessageBox("Logged in successfully!");
                        }
                    } else {
                        // --- Signup Logic ---
                        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                        const user = userCredential.user;

                        // Send email verification to the newly created user
                        await sendEmailVerification(user);
                        console.log('Firebase: Verification email sent.');

                        // Immediately log out the user to enforce email verification before re-login
                        await signOut(auth);
                        console.log('Firebase: User logged out after sending verification email.');

                        authModal.classList.remove('show'); // Close modal
                        document.body.classList.remove('overflow-hidden'); // Allow scrolling
                        showMessageBox(`Account created for ${email}! Please check your inbox and verify your email before logging in.`, () => {
                            // Optional action after user acknowledges, e.g., clear form or redirect
                        });
                    }
                } catch (error) {
                    // Handle specific Firebase authentication errors and display user-friendly messages
                    let errorMessage = 'An unknown authentication error occurred.';
                    switch (error.code) {
                        case 'auth/invalid-email':
                            errorMessage = 'Invalid email address format.';
                            break;
                        case 'auth/user-not-found':
                            errorMessage = 'No user found with this email. Please sign up or check your email.';
                            break;
                        case 'auth/wrong-password':
                            errorMessage = 'Incorrect password. Please try again.';
                            break;
                        case 'auth/email-already-in-use':
                            errorMessage = 'This email is already registered. Please log in instead or use a different email.';
                            break;
                        case 'auth/weak-password':
                            errorMessage = 'Password should be at least 6 characters long.';
                            break;
                        case 'auth/network-request-failed':
                            errorMessage = 'Network error. Please check your internet connection.';
                            break;
                        default:
                            errorMessage = `Error: ${error.message}`;
                            break;
                    }
                    if (authErrorMessage) authErrorMessage.textContent = errorMessage; // Display error message in the modal
                    console.error('Firebase: Authentication error details:', error);
                }
            });
        }


        // Event listener for Resend Verification Email button
        if (resendVerificationBtn && authEmailInput && authPasswordInput && authErrorMessage) {
            resendVerificationBtn.addEventListener('click', async () => {
                const email = authEmailInput.value.trim();
                if (!email) {
                    if (authErrorMessage) authErrorMessage.textContent = 'Please enter your email to resend verification.';
                    return;
                }

                // Attempt to sign in first to get the user object if they are not signed in
                try {
                    // Note: This signInWithEmailAndPassword will only work if the user has a valid password
                    // corresponding to the email, even if not verified.
                    const userCredential = await signInWithEmailAndPassword(auth, email, authPasswordInput.value.trim());
                    const user = userCredential.user;

                    if (user && !user.emailVerified) {
                        await sendEmailVerification(user);
                        showMessageBox("Verification email re-sent! Please check your inbox.");
                        console.log('Firebase: Verification email re-sent.');
                    } else if (user && user.emailVerified) {
                        showMessageBox("Your email is already verified. You can now log in.");
                    } else {
                        showMessageBox("Could not find a user with this email or user not found. Please sign up or check your credentials.");
                    }
                    await signOut(auth); // Keep them logged out until verified
                } catch (error) {
                    let errorMessage = 'Failed to resend verification email. Please ensure your email and password are correct and try again.';
                    console.error('Firebase: Error re-sending verification email:', error);
                    if (authErrorMessage) authErrorMessage.textContent = errorMessage;
                }
            });
        }


        // --- Logout Logic ---
        const logoutBtn = document.getElementById('logout-btn'); // Desktop logout button
        const mobileLogoutBtn = document.getElementById('mobile-logout-btn'); // Mobile logout button

        // Event listener for desktop logout button
        if (logoutBtn) {
            logoutBtn.addEventListener('click', async () => {
                try {
                    await signOut(auth); // Sign out the current user
                    console.log('Firebase: User logged out.');
                    showMessageBox("Logged out successfully!");
                }
                 catch (error) {
                    console.error('Firebase: Logout error:', error);
                    showMessageBox(`Logout failed: ${error.message}`);
                }
            });
        }

        // Event listener for mobile logout button
        if (mobileLogoutBtn) {
            mobileLogoutBtn.addEventListener('click', async () => {
                try {
                    await signOut(auth); // Sign out the current user
                    console.log('Firebase: User logged out from mobile.');
                    showMessageBox("Logged out successfully!");
                    // Close the mobile menu after logout
                    const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
                    if (mobileMenuOverlay) mobileMenuOverlay.classList.add('hidden');
                } catch (error) {
                    console.error('Firebase: Mobile logout error:', error);
                    showMessageBox(`Mobile logout failed: ${error.message}`);
                }
            });
        }

        // --- Fun Saturday Section Interactivity ---
        const learnMoreButtons = document.querySelectorAll('.learn-more-btn');
        learnMoreButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                const title = event.target.dataset.activityTitle;
                const info = event.target.dataset.activityInfo;
                showMessageBox(`<strong>${title}</strong><br><br>${info}`);
            });
        });


        // --- AI Quiz Generation Logic ---
        const quizModal = document.getElementById('quiz-modal');
        const quizCloseButton = document.getElementById('quiz-close-button');
        const quizTitle = document.getElementById('quiz-title');
        const quizLoadingSpinner = document.getElementById('quiz-loading-spinner');
        const quizQuestionsContainer = document.getElementById('quiz-questions-container');
        const quizSubmitBtn = document.getElementById('quiz-submit-btn');
        const quizRetakeBtn = document.getElementById('quiz-retake-btn');
        const quizResults = document.getElementById('quiz-results');
        const generateQuizButtons = document.querySelectorAll('.generate-quiz-btn');

        // Close quiz modal
        if (quizCloseButton) {
            quizCloseButton.addEventListener('click', () => {
                if (quizModal) quizModal.classList.remove('show');
                document.body.classList.remove('overflow-hidden'); // Allow scrolling
                resetQuizModal();
            });
        }

        if (quizModal) {
            quizModal.addEventListener('click', (e) => {
                if (e.target === quizModal) {
                    quizModal.classList.remove('show');
                    document.body.classList.remove('overflow-hidden'); // Allow scrolling
                    resetQuizModal();
                }
            });
        }

        // Reset quiz modal state
        const resetQuizModal = () => {
            quizTitle.textContent = '';
            quizQuestionsContainer.innerHTML = '';
            quizResults.textContent = '';
            quizSubmitBtn.classList.add('hidden');
            quizRetakeBtn.classList.add('hidden');
            quizLoadingSpinner.classList.add('hidden');
            quizData = []; // Clear stored quiz data
        };

        // Event listeners for "Generate Quiz" buttons
        generateQuizButtons.forEach(button => {
            button.addEventListener('click', async (event) => {
                const topic = event.target.dataset.topic;
                console.log(`Generating quiz for topic: ${topic}`);

                resetQuizModal(); // Clear any previous quiz
                quizModal.classList.add('show');
                document.body.classList.add('overflow-hidden'); // Prevent background scrolling
                quizTitle.textContent = `Generating ${topic} Quiz...`;
                quizLoadingSpinner.classList.remove('hidden');

                try {
                    const prompt = `Generate a 5 multiple-choice questions quiz on ${topic} suitable for high school students. Each question should have 4 options (A, B, C, D) and one correct answer. Provide the output as a JSON array of objects. Each object in the array should have the following properties:
                    "question": (string) - The text of the question.
                    "options": (array of strings) - An array containing the four answer options.
                    "correctAnswer": (string) - The exact text of the correct option.`;

                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                    const payload = {
                        contents: chatHistory,
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: "ARRAY",
                                items: {
                                    type: "OBJECT",
                                    properties: {
                                        "question": { "type": "STRING" },
                                        "options": {
                                            "type": "ARRAY",
                                            "items": { "type": "STRING" }
                                        },
                                        "correctAnswer": { "type": "STRING" }
                                    },
                                    "propertyOrdering": ["question", "options", "correctAnswer"]
                                }
                            }
                        }
                    };

                    const apiKey = "AIzaSyDQWI0TBEyNibnSXePrPUjhWg8bq0t-Z9E"; // Canvas will automatically provide this at runtime.
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`API error: ${response.status} - ${errorData.message || 'Unknown error'}`);
                    }

                    const result = await response.json();
                    console.log("AI Quiz Generation Raw Result:", result);

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const jsonString = result.candidates[0].content.parts[0].text;
                        quizData = JSON.parse(jsonString); // Store the quiz data globally
                        console.log("Parsed Quiz Data:", quizData);
                        renderQuiz(quizData, topic);
                    } else {
                        throw new Error("Invalid response format from AI model. Please try again.");
                    }

                } catch (error) {
                    console.error('Error generating quiz:', error);
                    quizTitle.textContent = `Failed to generate quiz.`;
                    quizQuestionsContainer.innerHTML = `<p class="text-red-400 text-center">${error.message || 'Please try again later.'}</p>`;
                    quizRetakeBtn.classList.remove('hidden'); // Allow retake attempt
                } finally {
                    quizLoadingSpinner.classList.add('hidden');
                }
            });
        });

        // Function to render the quiz questions
        const renderQuiz = (questions, topic) => {
            quizQuestionsContainer.innerHTML = ''; // Clear previous questions
            quizTitle.textContent = `${topic} Quiz`;
            quizResults.textContent = '';
            quizSubmitBtn.classList.remove('hidden');
            quizRetakeBtn.classList.add('hidden'); // Hide retake until results are shown

            questions.forEach((q, qIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'bg-[#0D0D0D] p-5 rounded-md shadow-md'; // Dark background for questions

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg mb-3';
                questionText.textContent = `${qIndex + 1}. ${q.question}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'flex flex-col space-y-2';

                q.options.forEach((option, oIndex) => {
                    const optionLabel = document.createElement('label');
                    optionLabel.className = 'flex items-center space-x-3 text-white cursor-pointer hover:bg-[#2A2A2A] p-2 rounded-md transition duration-200';
                    optionLabel.innerHTML = `
                        <input type="radio" name="question-${qIndex}" value="${option}" class="form-radio text-[#FF8C00] h-5 w-5 quiz-option">
                        <span>${option}</span>
                    `;
                    optionsDiv.appendChild(optionLabel);
                });
                questionDiv.appendChild(optionsDiv);
                quizQuestionsContainer.appendChild(questionDiv);
            });
        };

        // Function to submit and score the quiz
        if (quizSubmitBtn) {
            quizSubmitBtn.addEventListener('click', () => {
                let score = 0;
                const totalQuestions = quizData.length;
                quizQuestionsContainer.querySelectorAll('.quiz-option').forEach(optionInput => {
                    optionInput.disabled = true; // Disable options after submission
                });

                quizData.forEach((q, qIndex) => {
                    const selectedOption = document.querySelector(`input[name="question-${qIndex}"]:checked`);
                    const questionDiv = quizQuestionsContainer.children[qIndex]; // Get the question div

                    if (selectedOption) {
                        const isCorrect = selectedOption.value === q.correctAnswer;
                        const optionLabels = questionDiv.querySelectorAll('label');

                        // Highlight selected option and correct answer
                        optionLabels.forEach(label => {
                            const input = label.querySelector('input');
                            if (input.value === q.correctAnswer) {
                                label.classList.add('bg-green-600', 'font-bold'); // Correct answer
                            } else if (input === selectedOption && !isCorrect) {
                                label.classList.add('bg-red-600', 'font-bold'); // Incorrectly selected
                            }
                        });

                        if (isCorrect) {
                            score++;
                        }
                    } else {
                        // If no option is selected, just highlight the correct one
                        const optionLabels = questionDiv.querySelectorAll('label');
                        optionLabels.forEach(label => {
                            const input = label.querySelector('input');
                            if (input.value === q.correctAnswer) {
                                label.classList.add('bg-green-600', 'font-bold');
                            }
                        });
                    }
                });

                quizResults.textContent = `You scored ${score} out of ${totalQuestions}!`;
                quizSubmitBtn.classList.add('hidden'); // Hide submit button
                quizRetakeBtn.classList.remove('hidden'); // Show retake button
            });
        }

        // Retake Quiz button action
        if (quizRetakeBtn) {
            quizRetakeBtn.addEventListener('click', () => {
                // This will re-trigger the generation of a new quiz based on the last topic clicked
                // For simplicity, we can simulate a click on the last topic button if needed.
                // Or, simply reset the modal and allow the user to click a topic again.
                resetQuizModal();
                // Optionally close the modal, or keep it open for new quiz selection
                quizModal.classList.remove('show');
                document.body.classList.remove('overflow-hidden');
            });
        }

        // --- AI Study Buddy Logic (existing, verified) ---
        const studyBuddyInput = document.getElementById('study-buddy-input');
        const getExplanationBtn = document.getElementById('get-explanation-btn');
        const studyBuddyLoading = document.getElementById('study-buddy-loading');
        const studyBuddyOutput = document.getElementById('study-buddy-output');

        if (getExplanationBtn) {
            getExplanationBtn.addEventListener('click', async () => {
                const prompt = studyBuddyInput.value.trim();
                if (!prompt) {
                    studyBuddyOutput.textContent = "Please enter a topic to explain.";
                    return;
                }

                studyBuddyOutput.textContent = ''; // Clear previous output
                studyBuddyLoading.classList.remove('hidden'); // Show loading spinner

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = "AIzaSyDQWI0TBEyNibnSXePrPUjhWg8bq0t-Z9E"; // Canvas will automatically provide this at runtime.
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`API error: ${response.status} - ${errorData.message || 'Unknown error'}`);
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        studyBuddyOutput.textContent = text;
                    } else {
                        studyBuddyOutput.textContent = "Sorry, I couldn't generate an explanation. Please try a different query.";
                    }
                } catch (error) {
                    console.error('Error fetching AI explanation:', error);
                    studyBuddyOutput.textContent = `Error: ${error.message}. Could not get an explanation. Please try again.`;
                } finally {
                    studyBuddyLoading.classList.add('hidden'); // Hide loading spinner
                }
            });
        }

    </script>
</body>
</html>
